<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimalist Resume Template</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Helvetica Neue', 'Arial', sans-serif;
        }

        /* Universal text overflow handling */
        .header *, .main-content * {
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            max-width: 100%;
        }

        /* Aggressive text breaking for URLs and long content */
        .sidebar {
            overflow-wrap: break-word;
            word-break: break-word;
            hyphens: auto;
        }

        .sidebar * {
            max-width: 100%;
            overflow-wrap: break-word;
            word-break: break-word;
        }

        /* Force break long URLs and text */
        a, .contact-item, .skill-name, .project-link,
        .contact-item, .contact-item *,
        [href], [href] * {
            word-break: break-all !important;
            overflow-wrap: break-word !important;
            hyphens: none !important;
            max-width: 100% !important;
            white-space: normal !important;
        }

        body {
            background-color: #f8fafc;
            color: #1a202c;
            line-height: 1.6;
            padding: 20px;
            margin: 0;
        }

        .resumetemplate_container {
            width: 210mm;  /* Exact A4 width */
            min-height: 297mm; /* Minimum A4 height */
            max-width: 794px; /* Fallback for screens */
            margin: 0 auto;
            background-color: #fff;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border-radius: 0;
            overflow: visible;
            position: relative;
        }

        @media screen {
            .resumetemplate_container {
                width: 794px; /* Screen fallback */
                max-width: 100vw;
            }
        }

        @media print {
            body {
                padding: 0;
                background-color: white;
                margin: 0;
            }

            .resumetemplate_container {
                width: 210mm;
                min-height: 297mm;
                box-shadow: none;
                margin: 0;
                overflow: visible;
                max-width: none;
            }

            .header {
                padding: 15mm 12mm;
            }

            .main-content {
                padding: 12mm 15mm;
            }
        }

        .header {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 35px 30px;
            text-align: center;
            position: relative;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, #1d4ed8, #2563eb, #1e40af);
        }

        .profile-img {
            width: 100px;
            height: 100px;
            border-radius: 8px;
            object-fit: cover;
            border: 3px solid rgba(255, 255, 255, 0.3);
            margin: 0 auto 20px;
            display: block;
        }

        .name {
            font-size: 36px;
            font-weight: 300;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .title {
            font-size: 18px;
            margin-bottom: 30px;
            opacity: 0.9;
            font-weight: 400;
        }

        .contact-row {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 30px;
        }

        .contact-item {
            display: flex;
            align-items: flex-start;
            font-size: 14px;
            opacity: 0.9;
            word-wrap: break-word;
            overflow-wrap: break-word;
            word-break: break-all;
            max-width: 100%;
            min-width: 0;
            white-space: normal;
            hyphens: none;
        }

        .contact-icon {
            margin-right: 8px;
            font-size: 16px;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .main-content {
            padding: 25px 30px;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .section {
            margin-bottom: 50px;
            position: relative;
            transition: transform 0.2s ease;
        }

        .section.draggable {
            cursor: move;
        }

        .section.dragging {
            opacity: 0.8;
            z-index: 100;
            background-color: #f7fafc;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.2);
            border-radius: 8px;
            padding: 15px;
        }

        .section .drag-handle {
            position: absolute;
            top: 5px;
            right: 5px;
            cursor: move;
            padding: 5px;
            font-size: 14px;
            color: #cbd5e0;
            transition: color 0.2s ease;
        }

        .section .drag-handle:hover {
            color: #667eea;
        }

        .section-placeholder {
            border: 3px dashed #3b82f6;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(29, 78, 216, 0.05));
            height: 60px;
            margin: 10px 0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #3b82f6;
            font-weight: 600;
            font-size: 14px;
            position: relative;
            overflow: hidden;
            animation: pulse 2s infinite;
            opacity: 1;
            transform: scale(1);
            transition: all 0.2s ease;
        }

        @keyframes pulse {
            0%, 100% {
                border-color: #3b82f6;
                background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(29, 78, 216, 0.05));
            }
            50% {
                border-color: #1d4ed8;
                background: linear-gradient(135deg, rgba(29, 78, 216, 0.08), rgba(59, 130, 246, 0.08));
            }
        }

        .section-title {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 30px;
            color: #2d3748;
            position: relative;
            padding-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 16px;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, #3b82f6, transparent);
        }

        .two-column-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
        }

        .skill-item {
            margin-bottom: 20px;
        }

        .skill-name {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2d3748;
        }

        .skill-bar {
            height: 4px;
            background-color: #e2e8f0;
            border-radius: 2px;
            overflow: hidden;
        }

        .skill-level {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #1d4ed8);
            border-radius: 2px;
        }

        .experience-item,
        .education-item,
        .project-item,
        .certification-item {
            margin-bottom: 35px;
            padding-bottom: 25px;
            border-bottom: 1px solid #e2e8f0;
        }

        .experience-item:last-child,
        .education-item:last-child,
        .project-item:last-child,
        .certification-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .experience-title,
        .education-title,
        .project-title,
        .certification-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #2d3748;
        }

        .experience-company,
        .education-university,
        .certification-issuer {
            font-size: 16px;
            color: #667eea;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .experience-date,
        .education-date,
        .certification-date {
            font-size: 14px;
            color: #718096;
            margin-bottom: 15px;
            font-style: italic;
        }

        .experience-description,
        .education-description,
        .project-description {
            font-size: 15px;
            color: #4a5568;
            line-height: 1.7;
        }

        .project-technologies {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .project-technology {
            background-color: #edf2f7;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            color: #4a5568;
            font-weight: 500;
            border: 1px solid #e2e8f0;
        }

        .project-link {
            display: inline-block;
            margin-top: 10px;
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
        }

        .project-link:hover {
            text-decoration: underline;
        }

        .language-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 12px 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .language-item:last-child {
            border-bottom: none;
        }

        .language-name {
            font-weight: 500;
            color: #2d3748;
        }

        .language-proficiency {
            color: #718096;
            font-size: 14px;
        }

        .additional-info-content {
            font-size: 15px;
            color: #4a5568;
            line-height: 1.7;
            padding: 25px;
            background-color: #f7fafc;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .professional-summary {
            font-size: 16px;
            color: #4a5568;
            line-height: 1.8;
            text-align: center;
            max-width: 700px;
            margin: 0 auto;
        }

        @media (max-width: 768px) {
            .two-column-grid {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .contact-row {
                flex-direction: column;
                gap: 15px;
            }
            
            .header {
                padding: 40px 30px;
            }
            
            .main-content {
                padding: 30px 25px;
            }
            
            .section {
                margin-bottom: 35px;
            }
        }
    </style>
</head>

<body>
    <div class="resumetemplate_container">
        <div class="header">
            <img src="https://via.placeholder.com/100" alt="Profile Image" class="profile-img" id="profile-img">
            <h1 class="name" id="full-name">Loading...</h1>
            <p class="title" id="professional-title">Loading...</p>
            
            <div class="contact-row">
                <div class="contact-item" id="email-container">
                    <span class="contact-icon">üìß</span>
                    <span id="email">Loading...</span>
                </div>
                <div class="contact-item" id="phone-container">
                    <span class="contact-icon">üì±</span>
                    <span id="phone">Loading...</span>
                </div>
                <div class="contact-item" id="website-container">
                    <span class="contact-icon">üåê</span>
                    <span id="website">Loading...</span>
                </div>
                <div class="contact-item" id="linkedin-container">
                    <span class="contact-icon">üëî</span>
                    <span id="linkedin">Loading...</span>
                </div>
                <div class="contact-item" id="address-container">
                    <span class="contact-icon">üìç</span>
                    <span id="address">Loading...</span>
                </div>
            </div>
        </div>

        <div class="main-content" id="main-content">
            <div class="section draggable" draggable="true" id="professional-summary-section">
                <span class="drag-handle">‚ãÆ‚ãÆ</span>
                <h2 class="section-title">Professional Summary</h2>
                <p id="professional-summary" class="professional-summary">Loading...</p>
            </div>

            <div class="two-column-grid">
                <div>
                    <div class="section draggable" draggable="true" id="work-experience-section">
                        <span class="drag-handle">‚ãÆ‚ãÆ</span>
                        <h2 class="section-title">Experience</h2>
                        <div id="work-experience-container"></div>
                    </div>

                    <div class="section draggable" draggable="true" id="education-section">
                        <span class="drag-handle">‚ãÆ‚ãÆ</span>
                        <h2 class="section-title">Education</h2>
                        <div id="education-container"></div>
                    </div>
                </div>

                <div>
                    <div class="section draggable" draggable="true" id="skills-section">
                        <span class="drag-handle">‚ãÆ‚ãÆ</span>
                        <h2 class="section-title">Skills</h2>
                        <div id="skills-container"></div>
                    </div>

                    <div class="section draggable" draggable="true" id="projects-section">
                        <span class="drag-handle">‚ãÆ‚ãÆ</span>
                        <h2 class="section-title">Projects</h2>
                        <div id="projects-container"></div>
                    </div>

                    <div class="section draggable" draggable="true" id="certifications-section">
                        <span class="drag-handle">‚ãÆ‚ãÆ</span>
                        <h2 class="section-title">Certifications</h2>
                        <div id="certifications-container"></div>
                    </div>

                    <div class="section draggable" draggable="true" id="languages-section">
                        <span class="drag-handle">‚ãÆ‚ãÆ</span>
                        <h2 class="section-title">Languages</h2>
                        <div id="languages-container"></div>
                    </div>
                </div>
            </div>

            <div class="section draggable" draggable="true" id="additional-info-section" style="display: none;">
                <span class="drag-handle">‚ãÆ‚ãÆ</span>
                <h2 class="section-title" id="additional-info-title">Additional Information</h2>
                <p id="additional-info-content" class="additional-info-content"></p>
            </div>
        </div>
    </div>

    <script>
        // Listen for messages from parent window (ResumePreview.tsx)
        window.addEventListener("message", function (event) {
            console.log("Message received:", event.data);
            if (event.data && event.data.type === "RESUME_DATA") {
                console.log("Processing resume data:", event.data.payload);
                renderResumeData(event.data.payload);
            }
        });

        // Function to render resume data to the template
        function renderResumeData(data) {
            console.log("Rendering data:", data);

            // Handle missing data structure to prevent errors
            if (!data) {
                console.error("No data provided to renderResumeData");
                return;
            }

            // Ensure we have sections object
            if (!data.sections) {
                data.sections = {};
            }

            // Move common data into sections for consistent rendering
            if (data.skills && !data.sections.skills) {
                data.sections.skills = data.skills;
            }

            if (data.workExperience && !data.sections.workExperience) {
                data.sections.workExperience = data.workExperience;
            } else if (data.workHistory && !data.sections.workExperience) {
                data.sections.workExperience = data.workHistory;
            }

            if (data.education && !data.sections.education) {
                data.sections.education = data.education;
            }

            if (data.certifications && !data.sections.certifications) {
                data.sections.certifications = data.certifications;
            }

            if (data.languages && !data.sections.languages) {
                data.sections.languages = data.languages;
            }

            if (data.additionalInfo && !data.sections.additionalInfo) {
                data.sections.additionalInfo = data.additionalInfo;
            }

            // Ensure personalInfo exists
            if (!data.personalInfo) {
                data.personalInfo = {};
            }

            // Merge contact info into personalInfo if separate
            if (data.contact) {
                data.personalInfo = { ...data.personalInfo, ...data.contact };
            }

            // Profile Image
            if (data.personalInfo.profileImage || data.personalInfo.photo || data.personalInfo.avatar) {
                const imageUrl = data.personalInfo.profileImage || data.personalInfo.photo || data.personalInfo.avatar;
                document.getElementById('profile-img').src = imageUrl;
                document.getElementById('profile-img').style.display = 'block';
            } else {
                document.getElementById('profile-img').style.display = 'none';
            }

            // Personal Info
            if (data.personalInfo.fullName) {
                document.getElementById('full-name').textContent = data.personalInfo.fullName;
            } else if (data.personalInfo.firstName || data.personalInfo.lastName) {
                document.getElementById('full-name').textContent = `${data.personalInfo.firstName || ''} ${data.personalInfo.lastName || ''}`.trim();
            } else {
                document.getElementById('full-name').style.display = 'none';
            }

            if (data.personalInfo.professionalTitle || data.personalInfo.jobTitle) {
                document.getElementById('professional-title').textContent = data.personalInfo.professionalTitle || data.personalInfo.jobTitle;
            } else {
                document.getElementById('professional-title').style.display = 'none';
            }

            if (data.personalInfo.professionalSummary || data.personalInfo.summary) {
                document.getElementById('professional-summary').textContent = data.personalInfo.professionalSummary || data.personalInfo.summary;
            } else {
                document.getElementById('professional-summary-section').style.display = 'none';
            }

            // Contact Info
            if (data.personalInfo.email) {
                document.getElementById('email').textContent = data.personalInfo.email;
            } else {
                document.getElementById('email-container').style.display = 'none';
            }

            if (data.personalInfo.phone) {
                document.getElementById('phone').textContent = data.personalInfo.phone;
            } else {
                document.getElementById('phone-container').style.display = 'none';
            }

            if (data.personalInfo.website) {
                document.getElementById('website').textContent = data.personalInfo.website;
                document.getElementById('website').setAttribute('href', data.personalInfo.website);
            } else {
                document.getElementById('website-container').style.display = 'none';
            }

            if (data.personalInfo.linkedin) {
                document.getElementById('linkedin').textContent = data.personalInfo.linkedin;
            } else {
                document.getElementById('linkedin-container').style.display = 'none';
            }

            if (data.personalInfo.address) {
                document.getElementById('address').textContent = data.personalInfo.address;
            } else {
                document.getElementById('address-container').style.display = 'none';
            }

            // Dynamically render all sections from the data
            renderSections(data.sections);
        }

        // Helper functions
        function formatDate(dateString, format = "medium") {
            if (!dateString) return "";

            const date = new Date(dateString);

            if (isNaN(date.getTime())) {
                return dateString; // Return original if invalid date
            }

            switch (format) {
                case "short":
                    return `${date.getMonth() + 1}/${date.getFullYear()}`;
                case "long":
                    return date.toLocaleDateString("en-US", {
                        year: "numeric",
                        month: "long",
                    });
                case "medium":
                default:
                    return date.toLocaleDateString("en-US", {
                        year: "numeric",
                        month: "short",
                    });
            }
        }

        function getDateRange(startDate, endDate, isCurrent = false, format = "medium") {
            const start = formatDate(startDate, format);

            if (isCurrent) {
                return `${start} - Present`;
            }

            const end = formatDate(endDate, format);
            return `${start} - ${end}`;
        }

        function proficiencyToPercentage(level, maxLevel = 10) {
            return (level / maxLevel) * 100;
        }

        // Function to dynamically render all sections
        function renderSections(sections) {
            // Render each section based on its type
            for (const [sectionKey, sectionData] of Object.entries(sections)) {
                switch (sectionKey) {
                    case 'skills':
                        renderSkills(sectionData);
                        break;
                    case 'workExperience':
                        renderWorkExperience(sectionData);
                        break;
                    case 'education':
                        renderEducation(sectionData);
                        break;
                    case 'projects':
                        renderProjects(sectionData);
                        break;
                    case 'certifications':
                        renderCertifications(sectionData);
                        break;
                    case 'languages':
                        renderLanguages(sectionData);
                        break;
                    case 'additionalInfo':
                        renderAdditionalInfo(sectionData);
                        break;
                    default:
                        // For any custom sections not explicitly handled
                        renderCustomSection(sectionKey, sectionData);
                }
            }

            // Hide sections that don't have data
            hideEmptySections(sections);
        }

        // Function to hide sections that don't have data
        function hideEmptySections(sections) {
            const sectionIds = {
                'skills': 'skills-section',
                'workExperience': 'work-experience-section',
                'education': 'education-section',
                'projects': 'projects-section',
                'certifications': 'certifications-section',
                'languages': 'languages-section'
            };

            for (const [sectionKey, sectionId] of Object.entries(sectionIds)) {
                if (!sections[sectionKey] ||
                    (Array.isArray(sections[sectionKey]) && sections[sectionKey].length === 0) ||
                    (typeof sections[sectionKey] === 'object' && Object.keys(sections[sectionKey]).length === 0)) {
                    const sectionElement = document.getElementById(sectionId);
                    if (sectionElement) {
                        sectionElement.style.display = 'none';
                    }
                }
            }
        }

        // Function to render skills
        function renderSkills(skills) {
            const skillsContainer = document.getElementById('skills-container');
            skillsContainer.innerHTML = '';

            if (skills && skills.length > 0) {
                skills.forEach(skill => {
                    const skillItem = document.createElement('div');
                    skillItem.className = 'skill-item';

                    const skillName = document.createElement('div');
                    skillName.className = 'skill-name';

                    const skillNameText = document.createElement('span');
                    skillNameText.textContent = skill.name || skill.skillName || '';

                    const skillPercentage = document.createElement('span');
                    // Convert proficiency level to percentage
                    const percentage = proficiencyToPercentage(skill.proficiency_level || skill.level || 5);
                    skillPercentage.textContent = `${Math.round(percentage)}%`;

                    skillName.appendChild(skillNameText);
                    skillName.appendChild(skillPercentage);

                    const skillBar = document.createElement('div');
                    skillBar.className = 'skill-bar';

                    const skillLevel = document.createElement('div');
                    skillLevel.className = 'skill-level';
                    skillLevel.style.width = `${percentage}%`;

                    skillBar.appendChild(skillLevel);
                    skillItem.appendChild(skillName);
                    skillItem.appendChild(skillBar);
                    skillsContainer.appendChild(skillItem);
                });
            } else {
                document.getElementById('skills-section').style.display = 'none';
            }
        }

        // Function to render work experience
        function renderWorkExperience(experiences) {
            const workExperienceContainer = document.getElementById('work-experience-container');
            workExperienceContainer.innerHTML = '';

            if (experiences && experiences.length > 0) {
                experiences.forEach(exp => {
                    const experienceItem = document.createElement('div');
                    experienceItem.className = 'experience-item';

                    const experienceTitle = document.createElement('h3');
                    experienceTitle.className = 'experience-title';
                    experienceTitle.textContent = exp.position || exp.jobTitle || exp.title || '';

                    const experienceCompany = document.createElement('p');
                    experienceCompany.className = 'experience-company';
                    experienceCompany.textContent = `${exp.company || ''}${exp.location ? ` | ${exp.location}` : ''}`;

                    const experienceDate = document.createElement('p');
                    experienceDate.className = 'experience-date';

                    // Format the date range
                    const isCurrent = exp.isCurrent || exp.current || false;
                    experienceDate.textContent = getDateRange(exp.startDate, exp.endDate, isCurrent);

                    const experienceDescription = document.createElement('p');
                    experienceDescription.className = 'experience-description';
                    experienceDescription.textContent = exp.description || '';

                    experienceItem.appendChild(experienceTitle);
                    experienceItem.appendChild(experienceCompany);
                    experienceItem.appendChild(experienceDate);
                    experienceItem.appendChild(experienceDescription);

                    workExperienceContainer.appendChild(experienceItem);
                });
            } else {
                document.getElementById('work-experience-section').style.display = 'none';
            }
        }

        // Function to render education
        function renderEducation(educations) {
            const educationContainer = document.getElementById('education-container');
            educationContainer.innerHTML = '';

            if (educations && educations.length > 0) {
                educations.forEach(edu => {
                    const educationItem = document.createElement('div');
                    educationItem.className = 'education-item';

                    const educationTitle = document.createElement('h3');
                    educationTitle.className = 'education-title';
                    educationTitle.textContent = edu.degree || edu.program || '';

                    const educationUniversity = document.createElement('p');
                    educationUniversity.className = 'education-university';
                    educationUniversity.textContent = edu.institution || edu.school || edu.university || '';

                    const educationDate = document.createElement('p');
                    educationDate.className = 'education-date';

                    // Format date range
                    const isCurrent = edu.isCurrent || edu.current || false;
                    educationDate.textContent = getDateRange(edu.startDate, edu.endDate, isCurrent);

                    const educationDescription = document.createElement('p');
                    educationDescription.className = 'education-description';
                    educationDescription.textContent = edu.description || '';

                    educationItem.appendChild(educationTitle);
                    educationItem.appendChild(educationUniversity);
                    educationItem.appendChild(educationDate);
                    educationItem.appendChild(educationDescription);

                    educationContainer.appendChild(educationItem);
                });
            } else {
                document.getElementById('education-section').style.display = 'none';
            }
        }

        // Function to render projects
        function renderProjects(projects) {
            const projectsContainer = document.getElementById('projects-container');
            projectsContainer.innerHTML = '';

            if (projects && projects.length > 0) {
                projects.forEach(project => {
                    const projectItem = document.createElement('div');
                    projectItem.className = 'project-item';

                    const projectTitle = document.createElement('h3');
                    projectTitle.className = 'project-title';
                    projectTitle.textContent = project.title;

                    // Technologies used
                    if (project.technologies && project.technologies.length > 0) {
                        const techContainer = document.createElement('div');
                        techContainer.className = 'project-technologies';

                        project.technologies.forEach(tech => {
                            const techItem = document.createElement('span');
                            techItem.className = 'project-technology';
                            techItem.textContent = tech;
                            techContainer.appendChild(techItem);
                        });

                        projectItem.appendChild(projectTitle);
                        projectItem.appendChild(techContainer);
                    } else {
                        projectItem.appendChild(projectTitle);
                    }

                    const projectDescription = document.createElement('p');
                    projectDescription.className = 'project-description';
                    projectDescription.textContent = project.description;
                    projectItem.appendChild(projectDescription);

                    // Project link if available
                    if (project.link) {
                        const projectLink = document.createElement('a');
                        projectLink.className = 'project-link';
                        projectLink.href = project.link;
                        projectLink.target = '_blank';
                        projectLink.textContent = 'View Project';
                        projectItem.appendChild(projectLink);
                    }

                    projectsContainer.appendChild(projectItem);
                });
            } else {
                document.getElementById('projects-section').style.display = 'none';
            }
        }

        // Function to render certifications
        function renderCertifications(certifications) {
            const certificationsContainer = document.getElementById('certifications-container');
            certificationsContainer.innerHTML = '';

            if (certifications && certifications.length > 0) {
                certifications.forEach(cert => {
                    const certItem = document.createElement('div');
                    certItem.className = 'certification-item';

                    const certTitle = document.createElement('h3');
                    certTitle.className = 'certification-title';
                    certTitle.textContent = cert.name;

                    const certIssuer = document.createElement('p');
                    certIssuer.className = 'certification-issuer';
                    certIssuer.textContent = cert.issuer;

                    const certDate = document.createElement('p');
                    certDate.className = 'certification-date';

                    // Format the date and expiration
                    const issueDate = new Date(cert.date);
                    let dateText = `Issued: ${issueDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}`;

                    if (cert.expires) {
                        const expiryDate = new Date(cert.expires);
                        dateText += ` | Expires: ${expiryDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}`;
                    }

                    certDate.textContent = dateText;

                    certItem.appendChild(certTitle);
                    certItem.appendChild(certIssuer);
                    certItem.appendChild(certDate);

                    certificationsContainer.appendChild(certItem);
                });
            } else {
                document.getElementById('certifications-section').style.display = 'none';
            }
        }

        // Function to render languages
        function renderLanguages(languages) {
            const languagesContainer = document.getElementById('languages-container');
            languagesContainer.innerHTML = '';

            if (languages && languages.length > 0) {
                languages.forEach(lang => {
                    const langItem = document.createElement('div');
                    langItem.className = 'language-item';

                    const langName = document.createElement('span');
                    langName.className = 'language-name';
                    langName.textContent = lang.name;

                    const langProficiency = document.createElement('span');
                    langProficiency.className = 'language-proficiency';
                    langProficiency.textContent = lang.proficiency;

                    langItem.appendChild(langName);
                    langItem.appendChild(langProficiency);

                    languagesContainer.appendChild(langItem);
                });
            } else {
                document.getElementById('languages-section').style.display = 'none';
            }
        }

        // Function to render additional info
        function renderAdditionalInfo(additionalInfo) {
            if (additionalInfo && additionalInfo.content) {
                document.getElementById('additional-info-section').style.display = 'block';
                document.getElementById('additional-info-title').textContent = additionalInfo.section_title || 'Additional Information';
                document.getElementById('additional-info-content').textContent = additionalInfo.content;
            }
        }

        // Function to render any custom sections not explicitly handled
        function renderCustomSection(sectionKey, sectionData) {
            // Create a new section if it doesn't exist
            const sectionId = `${sectionKey.replace(/\s+/g, '-').toLowerCase()}-section`;
            let sectionElement = document.getElementById(sectionId);

            if (!sectionElement) {
                // Create the section container
                sectionElement = document.createElement('div');
                sectionElement.id = sectionId;
                sectionElement.className = 'section draggable';
                sectionElement.setAttribute('draggable', 'true');

                // Create the section title
                const sectionTitle = document.createElement('h2');
                sectionTitle.className = 'section-title';
                sectionTitle.textContent = sectionKey.replace(/_/g, ' ')
                    .split(' ')
                    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                    .join(' ');

                // Create the content container
                const contentContainer = document.createElement('div');
                contentContainer.id = `${sectionId}-container`;

                // Append elements
                sectionElement.appendChild(sectionTitle);
                sectionElement.appendChild(contentContainer);

                // Add to main content
                document.querySelector('.main-content').appendChild(sectionElement);

                // Render the content based on data type
                if (Array.isArray(sectionData)) {
                    // If it's an array, render as list items
                    sectionData.forEach(item => {
                        const itemElement = document.createElement('div');
                        itemElement.className = 'custom-item';

                        // Try to intelligently render based on common properties
                        if (typeof item === 'object') {
                            // Title/name
                            if (item.title || item.name) {
                                const titleElement = document.createElement('h3');
                                titleElement.className = 'custom-title';
                                titleElement.textContent = item.title || item.name;
                                itemElement.appendChild(titleElement);
                            }

                            // Description
                            if (item.description) {
                                const descElement = document.createElement('p');
                                descElement.className = 'custom-description';
                                descElement.textContent = item.description;
                                itemElement.appendChild(descElement);
                            }

                            // Other properties
                            for (const [key, value] of Object.entries(item)) {
                                if (key !== 'id' && key !== 'title' && key !== 'name' && key !== 'description') {
                                    const propElement = document.createElement('p');
                                    propElement.className = 'custom-property';
                                    propElement.textContent = `${key.replace(/_/g, ' ')}: ${value}`;
                                    itemElement.appendChild(propElement);
                                }
                            }
                        } else {
                            // Simple value
                            itemElement.textContent = item;
                        }

                        contentContainer.appendChild(itemElement);
                    });
                } else if (typeof sectionData === 'object') {
                    // If it's an object, render properties
                    for (const [key, value] of Object.entries(sectionData)) {
                        if (key !== 'section_title') {
                            const propElement = document.createElement('p');
                            propElement.className = 'custom-property';
                            propElement.textContent = `${key.replace(/_/g, ' ')}: ${value}`;
                            contentContainer.appendChild(propElement);
                        }
                    }
                } else {
                    // Simple value
                    const textElement = document.createElement('p');
                    textElement.textContent = sectionData;
                    contentContainer.appendChild(textElement);
                }
            }
        }

        // Drag and Drop Functionality
        let draggedElement = null;
        let placeholder = null;
        let dropPosition = null;
        let targetElement = null;

        function updateDropPosition(e, target) {
            if (!target || !draggedElement) return;

            target.classList.add('drag-over');
            const rect = target.getBoundingClientRect();
            const midpoint = rect.top + rect.height / 2;
            const insertBefore = e.clientY < midpoint;

            dropPosition = {
                target: target,
                insertBefore: insertBefore,
                parent: target.parentNode,
                nextSibling: insertBefore ? target : target.nextSibling
            };

            if (placeholder && placeholder.parentNode) {
                placeholder.parentNode.removeChild(placeholder);
            }

            try {
                if (insertBefore) {
                    target.parentNode.insertBefore(placeholder, target);
                } else {
                    target.parentNode.insertBefore(placeholder, target.nextSibling);
                }

                requestAnimationFrame(() => {
                    if (placeholder && placeholder.parentNode) {
                        placeholder.style.opacity = '1';
                        placeholder.style.transform = 'scale(1)';
                    }
                });
            } catch (error) {
                console.log('Placeholder insertion failed:', error);
            }
        }

        function initializeDragAndDrop() {
            const draggableElements = document.querySelectorAll('.draggable');

            draggableElements.forEach(element => {
                element.addEventListener('dragstart', handleDragStart);
                element.addEventListener('dragend', handleDragEnd);
                element.addEventListener('dragover', handleDragOver);
                element.addEventListener('drop', handleDrop);
                element.addEventListener('dragenter', handleDragEnter);
                element.addEventListener('dragleave', handleDragLeave);
            });
        }

        function handleDragStart(e) {
            draggedElement = this;
            this.classList.add('dragging');
            placeholder = document.createElement('div');
            placeholder.className = 'section-placeholder';
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.outerHTML);
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            if (placeholder && placeholder.parentNode) {
                placeholder.parentNode.removeChild(placeholder);
            }
            draggedElement = null;
            placeholder = null;
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDragEnter(e) {
            dragCounter++;

            if (this !== draggedElement && this.classList.contains('draggable')) {
                // Check if both elements are in the same container
                const draggedContainer = draggedElement?.closest('.main-content, .two-column-grid > div');
                const targetContainer = this.closest('.main-content, .two-column-grid > div');

                if (draggedContainer === targetContainer) {
                    lastValidTarget = this;

                    // Add hover effect
                    this.classList.add('drag-over');

                    // Calculate drop position with precise positioning
                    const rect = this.getBoundingClientRect();
                    const midpoint = rect.top + rect.height / 2;

                    // Remove existing placeholder first
                    if (placeholder && placeholder.parentNode) {
                        placeholder.parentNode.removeChild(placeholder);
                    }

                    // Determine exact insertion point
                    const insertBefore = e.clientY < midpoint;

                    if (insertBefore) {
                        this.parentNode.insertBefore(placeholder, this);
                    } else {
                        this.parentNode.insertBefore(placeholder, this.nextSibling);
                    }

                    // Smooth placeholder appearance
                    requestAnimationFrame(() => {
                        if (placeholder) {
                            placeholder.style.opacity = '1';
                            placeholder.style.transform = 'scale(1)';
                        }
                    });
                }
            }
        }

        function handleDragLeave(e) {
            // Only remove placeholder if we're leaving the container entirely
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }

            // Remove drag-over effect
            this.classList.remove('drag-over');

            if (draggedElement && placeholder && placeholder.parentNode) {
                // Check if both elements are in the same container
                const draggedContainer = draggedElement?.closest('.main-content, .two-column-grid > div');
                const targetContainer = this.closest('.main-content, .two-column-grid > div');

                if (draggedContainer === targetContainer) {
                    // Get the exact position where placeholder is
                    const placeholderParent = placeholder.parentNode;
                    const placeholderNextSibling = placeholder.nextSibling;

                    // Remove placeholder first to avoid spacing issues
                    placeholderParent.removeChild(placeholder);

                    // Insert dragged element at the exact position
                    if (placeholderNextSibling) {
                        placeholderParent.insertBefore(draggedElement, placeholderNextSibling);
                    } else {
                        placeholderParent.appendChild(draggedElement);
                    }

                    // Add success animation
                    draggedElement.style.transition = 'transform 0.2s ease';
                    draggedElement.style.transform = 'scale(1.02)';
                    setTimeout(() => {
                        draggedElement.style.transform = '';
                        setTimeout(() => {
                            draggedElement.style.transition = '';
                        }, 200);
                    }, 100);
                }
            }
            return false;
        }

        // Initialize drag and drop when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeDragAndDrop();
        });

        // Re-initialize drag and drop after data is loaded
        window.addEventListener("message", function (event) {
            if (event.data && event.data.type === "RESUME_DATA") {
                setTimeout(() => {
                    initializeDragAndDrop();
                }, 100);
            }
        });
    </script>
</body>

</html>
